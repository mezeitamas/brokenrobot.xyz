---
import { Picture } from 'astro:assets';
import { type CollectionEntry, getCollection } from 'astro:content';

import ArticleLayout from '@layouts/ArticleLayout.astro';

import PublishDate from '@components/blog-posts/PublishDate.astro';
import ReadingTime from '@components/blog-posts/ReadingTime.astro';

import { SITE_METADATA } from '../../consts';

export async function getStaticPaths() {
    const posts = await getCollection('blog');

    return posts.map((post) => ({
        params: { slug: post.slug },
        props: post
    }));
}

type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content, remarkPluginFrontmatter } = await post.render();
const {
    data: { title, excerpt, publishDate, heroImage, tags }
} = post;
---

<ArticleLayout
    title={title}
    excerpt={excerpt}
    publishDate={publishDate}
    heroImage={heroImage}
    tags={tags}
>
    <Fragment slot="content">
        <article>
            <header>
                <h1>{title}</h1>

                <div class="flex flex-col sm:flex-row sm:gap-8">
                    <PublishDate date={publishDate} />

                    <ReadingTime minutesRead={remarkPluginFrontmatter.minutesRead} />
                </div>
            </header>

            <section>
                <Picture
                    src={heroImage}
                    alt={title}
                    formats={['avif', 'webp']}
                    widths={SITE_METADATA.SRC_SET_BREAKPOINTS}
                    loading="lazy"
                    decoding="async"
                    pictureAttributes={{
                        class: 'not-prose rounded-lg'
                    }}
                    class="not-prose rounded-lg"
                />

                <Content />
            </section>
        </article>
    </Fragment>
</ArticleLayout>
